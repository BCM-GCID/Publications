### Pre-processing of reads
Raw fastqs were pre-processd to remove Illumina adapters, low quality reads and any human reads present.

```{sh}
paste <(zstd -dcq Sample1_R1_001.fastq.gz | paste - - - -) <(zstd -dcq Sample1_R2_001.fastq.gz | paste - - - - ) | tr "\t" "\n" | \
# quality filtering and adapter trimming
bbduk.sh -Xmx20g in=stdin.fq int=t stats=bbduk.stats.log qtrim=rl trimq=25 minlength=50 overwrite=t qout=33 mink=10 minavgquality=23 ktrim=r k=19 hdist=1 ref=adapters.fa maxns=0 threads=40 out=stdout.fq tbo=t tpe=t strictoverlap=f entropy=.80 2>trim.log | \
# human read filtering in two steps
bloomfilter.sh -Xmx40G serialin=hg38.bloom.serial in=stdin.fq int=t outu=stdout.fq ow=t minhits=45 2>bloomfilter.log | \
bbmap.sh -Xmx60g int=t in=stdin.fq path=/ssd0/prod/db/hg38phix/hg38phixBbMap k=15 fast=t noheader=t notags=t outu=stdout.fq usejni=t cigar=f minid=.90 bloom=t bloomk=25 usemodulo=t threads=40 2>host.align.bbmap.log | \
# separate interleaved stdout.fq into 
paste - - - - - - - - | tee >(cut -f1-4 | tr "\t" "\n" | zstd -c -q -T40 > trimmedSample1.1.fq.zst) | cut -f5-8 | tr "\t" "\n" | zstd -c -q -T40 > trimmedSample1.2.fq.zst; 
```

### Running Virmap
Virmap was run on the trimmed and host filtered reads with the following parameters.

```{sh}
Virmap.pl --optionsFile Sample1.params.txt 2>Sample1.virmap.err

# Parameters file
--outputDir VirmapOutput/Sample1 \
--sampleName Sample1 \
--readF trimmedSample1.1.fq.zst \
--readR trimmedSample1.2.fq.zst \
--threads 40 \
--gbBlastx VirmapDatabases/gbBlastx.dmnd \
--gbBlastn VirmapDatabases/gbBlastn \
--virBbmap VirmapDatabases/virBbmap \
--virDmnd VirmapDatabases/virDmnd.dmnd \
--taxaJson VirmapDatabases/Taxonomy.virmap \
--adapterFile adapters.fa \
--bbMapLimit 5 \
--normCount \
--mergeReads \
--megahit \
--combineMerge \
--mappedReadsOut \
--normLimit 3 \
--noIterImp 
```

### Post analysis

Read statistics reported in the supplementary material were extracted from log files of the individual processing steps (e.g. trim.log, host filter log).

Full length genome reconstructions were extracted from the "Sample1.final.fa" output files generated by Virmap. Virus read counts, coverage and length information is encoded in the fasta header of the raw outputs and was collected per sample from those files. 